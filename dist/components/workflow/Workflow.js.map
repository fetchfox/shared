{"version":3,"file":"Workflow.js","names":["React","useState","useEffect","useRef","FaArrowAltCircleDown","FaCheckCircle","IoArrowUndo","useGlobalContext","primaryColor","GenericStep","step","prettyName","onEdit","onRemove","library","desc","name","keys","Object","args","render","key","argDesc","console","log","format","createElement","map","x","JSON","stringify","rows","style","width","whiteSpace","upperFirst","className","Step","index","last","workflow","workflowId","extraClasses","onSubmit","onAddStep","onSetStepWithName","onUndo","loading","setLoading","editing","setEditing","allNull","cancel","wrap","node","submit","editNode","NewStep","onChange","onCancel","fallbackPrettyName","replace","pair","border","background","boxShadow","borderRadius","padding","fontSize","position","right","height","display","alignItems","onClick","marginTop","size","textAlign","color","justifyContent","Workflow","pairs","steps","results","resultsWithItems","Array","isArray","length","done","push","parse","i","result","nodes","props","lastResult","id"],"sources":["../../../src/components/workflow/Workflow.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { FaArrowAltCircleDown, FaCheckCircle } from 'react-icons/fa';\nimport { IoArrowUndo } from \"react-icons/io5\";\nimport { useGlobalContext }  from '@/src/contexts/index.js';\n\nimport { primaryColor } from '@/src/constants.js';\n\nconst GenericStep = ({ step, prettyName, onEdit, onRemove }) => {\n  const { library } = useGlobalContext();\n  const desc = library ? library[step?.name] : {};\n  const keys = Object.keys(step?.args);\n\n  // return (\n  //   <div>\n  //     {step?.name}<br/><br/>\n  //     {JSON.stringify(desc)}<br/><br/>\n  //     {JSON.stringify(keys)}<br/><br/>\n  //     {JSON.stringify(library)}<br/><br/>\n  //   </div>\n  // );\n\n  // const desc = library ? library[step?.name] : {};\n  // const keys = Object.keys(step?.args);\n  // const keys = Object.keys(desc?.args);\n\n  if (!desc?.args) return null;\n\n  const render = (key) => {\n    if (!desc) return null;\n\n    const argDesc = desc.args[key];\n\n    console.log('key', key);\n    console.log('step.args', step.args);\n    console.log('argDesc', argDesc);\n\n    switch (argDesc.format) {\n      case 'list':\n        return <ul>{step.args[key].map(x => <li>{x}</li>)}</ul>;\n\n      case 'object':\n        return JSON.stringify(step.args);\n\n      case 'boolean':\n        return step.args[key] ? 'yes' : 'no';\n\n      case 'choices':\n        return step.args[key];\n\n      default:\n        return JSON.stringify(step.args[key]);\n    }\n  }\n\n  const rows = keys.map(key => (\n    <tr>\n      <th style={{ width: '100px', whiteSpace: 'nowrap' }}>{key.upperFirst()}</th>\n      <td style={{ width: '100%' }}>{render(key)}</td>\n    </tr>\n  ));\n\n  return (\n    <div>\n      {/*(<StepHeader\n        prettyName={prettyName}\n        onEdit={onEdit}\n        onRemove={onRemove}\n      />*/}\n\n      <table className=\"dense\">\n        <tbody>{rows}</tbody>\n      </table>\n    </div>\n  );\n}\n\nexport const Step = ({\n  index,\n  step,\n  last,\n  workflow,\n  workflowId,\n  extraClasses,\n  onSubmit,\n  onAddStep,\n  onSetStepWithName,\n  onRemove,\n  onUndo,\n}) => {\n\n  const [loading, setLoading] = useState();\n  const [editing, setEditing] = useState();\n\n  useEffect(() => {\n    let allNull = true;\n    for (const key of Object.keys(step?.args || {})) {\n      if (step.args[key] != null) allNull = false;\n    }\n    if (allNull) {\n      setEditing(true);\n    }\n  }, [step?.name]);\n\n  const cancel = () => {\n    setEditing(false);\n  }\n\n  const wrap = (node) => {\n    return (\n      <form onSubmit={submit}>\n        {node}\n      </form>\n    );\n  }\n\n  let node;\n  let editNode;\n\n  if (step.name == 'new') {\n    editNode = (\n      <NewStep\n        onChange={(name) => onSetStepWithName(name, index)}\n        onCancel={onRemove}\n      />\n    );\n  } else {\n    //const fallbackPrettyName = `Step ${index + 1}: ${step.name.replace(/-/g, ' ').upperFirst()}`;\n    const fallbackPrettyName = `${step.name.replace(/-/g, ' ').upperFirst()}`;\n\n    let pair = null;\n\n    // let pair = {\n    //   'const': [\n    //     <ConstStep\n    //       index={index}\n    //       step={step}\n    //       prettyName={`Initialize`}\n    //     />,\n    //     null,\n    //   ],\n    //   'exportUrls': [\n    //     <ExportUrlsStep\n    //       index={index}\n    //       step={step}\n    //       workflow={workflow}\n    //       prettyName={`Export Files`}\n    //       onEdit={() => setEditing(true)}\n    //       onRemove={onRemove}\n    //     />,\n    //     <ExportUrlsStepEdit\n    //       index={index}\n    //       step={step}\n    //       workflow={workflow}\n    //       prettyName={`Export Files`}\n    //       onSubmit={onSubmit}\n    //       onDone={() => setEditing(false)}\n    //       onRemove={onRemove}\n    //     />,\n    //   ],\n    // }[step.name];\n\n    if (!pair) {\n      pair = [\n        <GenericStep\n          index={index}\n          step={step}\n          prettyName={fallbackPrettyName}\n          onEdit={() => setEditing(true)}\n          onRemove={onRemove}\n        />,\n        null,\n        // <GenericStepEdit\n        //   step={step}\n        //   index={index}\n        //   workflowId={workflowId}\n        //   prettyName={fallbackPrettyName}\n        //   onSubmit={onSubmit}\n        //   onDone={() => setEditing(false)}\n        //   onRemove={onRemove}\n        // />,\n      ];\n    }\n\n    node = pair[0];\n    editNode = pair[1];\n  }\n\n  return (\n    <div className={extraClasses}>\n      <div style={{ border: '1px solid #ccc',\n                    background: '#f3f3f3',\n                    boxShadow: `2px 2px #eee`,\n                    borderRadius: 4,\n                    padding: 10,\n                    fontSize: 14,\n                  }}>\n        {!editing && node}\n        {editing && editNode}\n      </div>\n\n      <div style={{ position: 'relative' }}>\n        <div style={{ position: 'absolute',\n                      right: 0,\n                      height: 46,\n                      display: 'flex',\n                      alignItems: 'center',\n                    }}>\n          {onUndo && <button\n            className=\"bt bt-white bt-sm\"\n            onClick={onUndo}\n            >\n            <IoArrowUndo style={{ marginTop: -2 }} size={14} /> Undo\n          </button>}\n          {<button\n            className=\"bt bt-white bt-sm\"\n            onClick={onAddStep}\n            >\n            Add Step\n          </button>}\n        </div>\n      {!last && (\n        <div style={{ padding: 10,\n                      width: '100%',\n                      textAlign: 'center',\n                      color: primaryColor,\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n        }}>\n        <FaArrowAltCircleDown size={24} />\n        </div>\n       )}\n      </div>\n    </div>\n  );\n}\n\nexport const Workflow = ({ workflow }) => {\n  const pairs = [];\n  const steps = workflow?.steps || [];\n\n  // TODO\n  const results = [];\n\n  let resultsWithItems = [];\n  if (results && Array.isArray(results)) {\n    resultsWithItems = results;\n      // .filter(x => (\n      //   x.error ||\n      //   x.didStart ||\n      //   x.items && x.items.length > 0\n      // ));\n  }\n\n  // Special case to show loading if:\n  // - Last step in resultsWithItems is `done`\n  // - The next item does not have `didStart` set\n  if (\n    resultsWithItems &&\n    results &&\n    resultsWithItems.length > 0 &&\n    resultsWithItems.length < results.length &&\n    resultsWithItems[resultsWithItems.length - 1].done)\n  {\n    // Deep copy and set it to `loading`\n    resultsWithItems.push(JSON.parse(JSON.stringify(\n      results[resultsWithItems.length]\n    )));\n    resultsWithItems[resultsWithItems.length - 1].loading = true;\n  }\n\n  for (let i = 0; i < steps.length; i++) {\n    pairs.push({\n      step: steps[i],\n      result: i >= (resultsWithItems || []).length ? {} : resultsWithItems[i],\n    });\n  }\n\n  let i = 0;\n  const nodes = pairs.map(pair => {\n    const index = i++;\n\n    const props = {\n      key: index,\n      index: index,\n      last: index == workflow?.steps.length - 1,\n      lastResult: index == resultsWithItems.length - 1,\n      // done: done,\n      // running: running,\n      step: pair.step,\n      result: pair.result,\n      workflow: workflow,\n      workflowId: workflow.id,\n      // onSubmit: (val) => handleSubmit(index, val),\n      // onAddStep: () => addStep({ name: 'new', args: {} }, index + 1),\n      // onSetStepWithName: (name, index) => setStepWithName(name, index),\n      // onRemove: () => removeStep(index),\n      // onUndo: undoData?.index == index + 1 ? undo : null,\n    };\n\n    return <Step {...props} />;\n    // if (withResults) {\n    //   return <Pair {...props} />;\n    // } else {\n    //   return <Step {...props} />;\n    // }\n  });\n\n  return (\n    <div>\n      {nodes}\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}